/*! For license information please see 900.e829fac8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[900],{4818(){},7900(e,a,r){r.r(a),r.d(a,{default:()=>p});var s=r(2555),t=r(5043),i=r(5685),n=r(5169),o=r(9098),c=r(9304),l=r(614);const d=(0,r(7784).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);r(4818);var m=r(579);const p=function(){const e=(0,i.Zp)(),{cart:a,getCartTotal:r,clearCart:p}=(0,n._)(),{currentUser:h}=(0,o.A)(),{showError:u,showSuccess:y}=(0,c.d)(),[g,x]=(0,t.useState)({firstName:"",lastName:"",phone:"",email:"",address:"",city:"",state:"",pincode:""}),[N,f]=(0,t.useState)({}),[j,v]=(0,t.useState)(!1),[w,_]=(0,t.useState)(0),[b,P]=(0,t.useState)(!1),[k,z]=(0,t.useState)(null);(0,t.useEffect)(()=>{new Promise((e,a)=>{if(window.Razorpay)return void e(window.Razorpay);const r=document.querySelector('script[src="https://checkout.razorpay.com/v1/checkout.js"]');if(r)return r.onload=()=>e(window.Razorpay),void(r.onerror=a);const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.async=!0,s.onload=()=>{window.Razorpay?e(window.Razorpay):a(new Error("Razorpay SDK failed to load"))},s.onerror=()=>a(new Error("Failed to load Razorpay script")),document.body.appendChild(s)}).catch(e=>{console.error("Error loading Razorpay:",e),u("Failed to load payment system. Please refresh the page and try again.")})},[u]),(0,t.useEffect)(()=>{a.length>0&&S()},[a]);const S=async()=>{try{P(!0);const e=a.map(e=>({product_id:e.id,quantity:e.quantity})),s=await fetch("/api/products/calculate-shipping/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e,subtotal:r()})}),t=await s.json();s.ok?_(t.shipping_charge):(console.error("Error calculating shipping:",t.error),_(100))}catch(e){console.error("Error calculating shipping:",e),_(100)}finally{P(!1)}},C=e=>{const{name:a,value:r}=e.target;x(e=>(0,s.A)((0,s.A)({},e),{},{[a]:r})),N[a]&&f(e=>(0,s.A)((0,s.A)({},e),{},{[a]:""}))},F=async(s,t)=>{try{const t={customer_name:"".concat(g.firstName," ").concat(g.lastName),customer_email:g.email,customer_phone:g.phone,shipping_address:g.address,shipping_city:g.city,shipping_state:g.state,shipping_pincode:g.pincode,billing_address:"",payment_method:"razorpay",payment_status:!1,subtotal:r(),shipping_charge:w,tax_amount:0,discount_amount:0,total_amount:r()+w,items:a.map(e=>({product:e.id,quantity:e.quantity,product_name:e.name,product_price:e.price}))};h&&(t.user_firebase_uid=h.uid);const i=await fetch("/api/products/verify-payment/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:s.razorpay_order_id,razorpay_payment_id:s.razorpay_payment_id,razorpay_signature:s.razorpay_signature,order_data:t})}),n=await i.json();if(console.log("Payment verification response:",n),!n.success)throw console.error("Payment verification failed:",n),new Error(n.error||"Payment verification failed");{const a="Payment successful! Order #".concat(n.order_number,". Confirmation email sent to ").concat(g.email);y(a),p(),setTimeout(()=>{e("/")},2e3)}}catch(i){console.error("Error verifying payment:",i);const e=null!==s&&void 0!==s&&s.razorpay_payment_id?"Payment received but order creation failed. Please contact support with Payment ID: ".concat(s.razorpay_payment_id):"Payment verification failed. Please try again or contact support.";u(e)}finally{v(!1)}};return 0===a.length?(e("/cart"),null):(0,m.jsxs)(m.Fragment,{children:[k&&(0,m.jsx)("div",{className:"payment-failed-overlay",onClick:()=>z(null),children:(0,m.jsxs)("div",{className:"payment-failed-modal",onClick:e=>e.stopPropagation(),children:[(0,m.jsx)("button",{className:"payment-failed-close",onClick:()=>z(null),"aria-label":"Close",children:(0,m.jsx)(l.A,{size:24})}),(0,m.jsx)("div",{className:"payment-failed-icon",children:(0,m.jsx)(d,{size:48,strokeWidth:1.5})}),(0,m.jsx)("h3",{className:"payment-failed-title",children:"Payment Failed"}),(0,m.jsx)("p",{className:"payment-failed-message",children:k}),(0,m.jsx)("button",{className:"payment-failed-btn",onClick:()=>z(null),children:"Try Again"})]})}),(0,m.jsxs)("div",{className:"checkout-page",children:[(0,m.jsx)("section",{className:"checkout-hero",style:{backgroundImage:"linear-gradient(90deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.7) 100%), url('/static/images/gallery/checkout.jpg')",backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:(0,m.jsxs)("div",{className:"hero-content",children:[(0,m.jsxs)("h1",{className:"hero-title",children:[(0,m.jsx)("span",{className:"japanese-accent",children:"\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8"}),(0,m.jsx)("span",{className:"main-title",children:"Checkout"})]}),(0,m.jsx)("p",{className:"hero-subtitle",children:"Complete your order"})]})}),(0,m.jsx)("section",{className:"checkout-content",children:(0,m.jsxs)("div",{className:"checkout-container",children:[(0,m.jsxs)("div",{className:"checkout-form-section",children:[(0,m.jsx)("h2",{children:"Delivery Information"}),(0,m.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return g.firstName.trim()||(e.firstName="First name is required"),g.lastName.trim()||(e.lastName="Last name is required"),g.phone.trim()?/^\d{10}$/.test(g.phone.replace(/\s/g,""))||(e.phone="Please enter a valid 10-digit phone number"):e.phone="Phone number is required",g.email.trim()?/\S+@\S+\.\S+/.test(g.email)||(e.email="Please enter a valid email address"):e.email="Email is required",g.address.trim()||(e.address="Delivery address is required"),g.city.trim()||(e.city="City is required"),g.state.trim()||(e.state="State is required"),g.pincode.trim()?/^\d{6}$/.test(g.pincode)||(e.pincode="Please enter a valid 6-digit pincode"):e.pincode="Pincode is required",f(e),0===Object.keys(e).length})()&&!j){v(!0);try{const e=r()+w,s="".concat(g.firstName," ").concat(g.lastName);console.log("Creating Razorpay order with data:",{amount:e,customer_name:s,customer_email:g.email,customer_phone:g.phone});const t=await fetch("/api/products/create-razorpay-order/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,customer_name:s,customer_email:g.email,customer_phone:g.phone})}),i=await t.json();if(console.log("Order creation response:",i),console.log("Order response status:",t.status),!i.success)throw console.error("Order creation failed:",i),new Error(i.error||"Failed to create payment order");if(console.log("About to initialize Razorpay with options:",{key:i.key,amount:i.amount,currency:i.currency,order_id:i.order_id,prefill:{name:s,email:g.email,contact:g.phone}}),!window.Razorpay)throw new Error("Razorpay SDK not loaded. Please refresh the page and try again.");const n={key:i.key,amount:i.amount,currency:i.currency,name:"Basho By Shivangi",description:"Product Purchase",order_id:i.order_id,handler:async function(e){console.log("Payment success response:",e),await F(e,i.order_id)},prefill:{name:s,email:g.email,contact:g.phone},notes:{address:g.address,city:g.city,state:g.state},theme:{color:"#8B4513"},modal:{ondismiss:function(){v(!1),u("Payment cancelled by user")},onerror:function(e){v(!1),console.error("Razorpay payment error:",e),u("Payment failed. Please try again or use a different payment method.")}}};console.log("Creating Razorpay instance...");try{const e=new window.Razorpay(n);e.on("payment.failed",function(e){var a;v(!1),console.error("Payment failed:",e.error);const r=(null===(a=e.error)||void 0===a?void 0:a.description)||"Payment failed. Please try again.";u("Payment failed: ".concat(r))}),console.log("Opening Razorpay checkout..."),e.open()}catch(a){throw console.error("Error creating Razorpay instance:",a),new Error("Failed to initialize payment: ".concat(a.message))}}catch(s){console.error("Error initiating payment:",s),u(s.message||"Failed to initiate payment. Please try again."),v(!1)}}},className:"checkout-form",children:[(0,m.jsxs)("div",{className:"form-row",children:[(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"firstName",children:"First Name *"}),(0,m.jsx)("input",{type:"text",id:"firstName",name:"firstName",value:g.firstName,onChange:C,className:N.firstName?"error":""}),N.firstName&&(0,m.jsx)("span",{className:"error-message",children:N.firstName})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"lastName",children:"Last Name *"}),(0,m.jsx)("input",{type:"text",id:"lastName",name:"lastName",value:g.lastName,onChange:C,className:N.lastName?"error":""}),N.lastName&&(0,m.jsx)("span",{className:"error-message",children:N.lastName})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"phone",children:"Phone Number *"}),(0,m.jsx)("input",{type:"tel",id:"phone",name:"phone",value:g.phone,onChange:C,placeholder:"10-digit mobile number",className:N.phone?"error":""}),N.phone&&(0,m.jsx)("span",{className:"error-message",children:N.phone})]})]}),(0,m.jsxs)("div",{className:"form-row two-col",children:[(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"email",children:"Email Address *"}),(0,m.jsx)("input",{type:"email",id:"email",name:"email",value:g.email,onChange:C,placeholder:"your@email.com",className:N.email?"error":""}),N.email&&(0,m.jsx)("span",{className:"error-message",children:N.email})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"address",children:"Delivery Address *"}),(0,m.jsx)("textarea",{id:"address",name:"address",value:g.address,onChange:C,rows:"2",placeholder:"House/Flat No., Street, Locality",className:N.address?"error":""}),N.address&&(0,m.jsx)("span",{className:"error-message",children:N.address})]})]}),(0,m.jsxs)("div",{className:"form-row",children:[(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"city",children:"City *"}),(0,m.jsx)("input",{type:"text",id:"city",name:"city",value:g.city,onChange:C,className:N.city?"error":""}),N.city&&(0,m.jsx)("span",{className:"error-message",children:N.city})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"state",children:"State *"}),(0,m.jsx)("input",{type:"text",id:"state",name:"state",value:g.state,onChange:C,className:N.state?"error":""}),N.state&&(0,m.jsx)("span",{className:"error-message",children:N.state})]}),(0,m.jsxs)("div",{className:"form-group",children:[(0,m.jsx)("label",{htmlFor:"pincode",children:"Pincode *"}),(0,m.jsx)("input",{type:"text",id:"pincode",name:"pincode",value:g.pincode,onChange:C,placeholder:"6-digit pincode",className:N.pincode?"error":""}),N.pincode&&(0,m.jsx)("span",{className:"error-message",children:N.pincode})]})]}),(0,m.jsx)("button",{type:"submit",className:"pay-btn",disabled:j,children:j?"Processing...":"Proceed to Payment"})]})]}),(0,m.jsxs)("div",{className:"checkout-summary",children:[(0,m.jsx)("h2",{children:"Order Summary"}),(0,m.jsx)("div",{className:"summary-items",children:a.map(e=>(0,m.jsxs)("div",{className:"summary-item",children:[(0,m.jsxs)("div",{className:"item-info",children:[(0,m.jsx)("span",{className:"item-name",children:e.name}),(0,m.jsxs)("span",{className:"item-qty",children:["x",e.quantity]})]}),(0,m.jsxs)("span",{className:"item-price",children:["\u20b9",(parseFloat(e.price)*e.quantity).toLocaleString("en-IN")]})]},e.id))}),(0,m.jsx)("div",{className:"summary-divider"}),(0,m.jsxs)("div",{className:"summary-row",children:[(0,m.jsx)("span",{children:"Subtotal"}),(0,m.jsxs)("span",{children:["\u20b9",r().toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,m.jsxs)("div",{className:"summary-row",children:[(0,m.jsx)("span",{children:"Shipping"}),(0,m.jsx)("span",{children:b?"Calculating...":"\u20b9".concat(w.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}))})]}),(0,m.jsx)("div",{className:"summary-divider"}),(0,m.jsxs)("div",{className:"summary-row total",children:[(0,m.jsx)("span",{children:"Total"}),(0,m.jsxs)("span",{children:["\u20b9",(r()+w).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]})]})}}}]);
//# sourceMappingURL=900.e829fac8.chunk.js.map